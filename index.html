<!DOCTYPE html>
<html>
  <head>
    <title>Backpack Showcase</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <style>
      body { height: 4000px; margin: 0; background: #000; overflow-x: hidden; }
      #ui {
        position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
        color: white; font-family: 'Segoe UI', sans-serif; text-align: center;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5); pointer-events: none; z-index: 10;
      }
      canvas { display: block; }
    </style>
  </head>
  <body>

    <div id="ui">
      <h1 style="font-size: 3rem; margin-bottom: 0;">EXPLORE THE GEAR</h1>
      <p style="font-size: 1.2rem; opacity: 0.8;">Scroll down to unpack</p>
    </div>

    <a-scene embedded shadow="type: pcfsoft">
      <a-assets>
        <a-asset-item id="backpack-model" src="backpack.glb"></a-asset-item>
      </a-assets>

      <a-entity environment="
        preset: forest; 
        active: true; 
        seed: 8; 
        skyType: gradient; 
        skyColor: #2391e9; 
        horizonColor: #e9f2f9; 
        lighting: ambient; 
        ground: flat; 
        groundColor: #467030; 
        groundColor2: #3e602b; 
        dressingAmount: 50;
        dressingColor: #2c4d1a;
      "></a-entity>

      <a-light type="directional" position="-1 4 3" intensity="0.8" castShadow="true"></a-light>
      <a-light type="ambient" intensity="0.4"></a-light>

      <a-cylinder 
        position="0 0.45 0" 
        radius="0.8" 
        height="0.9" 
        color="#222" 
        roughness="0.8" 
        shadow="receive: true">
      </a-cylinder>

      <a-entity 
        id="backpack"
        gltf-model="#backpack-model" 
        position="0 0.9 0" 
        rotation="0 45 0"
        scale="1.5 1.5 1.5"
        shadow="cast: true"
        scroll-morph-control>
      </a-entity>

      <a-entity camera position="0 1.8 3.5" look-controls="enabled: false"></a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent('scroll-morph-control', {
        init: function () {
          this.el.addEventListener('model-loaded', () => {
            this.mesh = this.el.getObject3D('mesh');
          });

          window.addEventListener('scroll', () => {
            if (!this.mesh) return;

            // scrollRange makes the animation finish before the bottom of the page
            const scrollMax = document.body.offsetHeight - window.innerHeight;
            const scrollPercent = Math.min(window.scrollY / scrollMax, 1);

            this.mesh.traverse((node) => {
              if (node.morphTargetInfluences) {
                // Apply scroll to the first shape key
                node.morphTargetInfluences[0] = scrollPercent;
              }
            });
            
            // Subtle rotation effect as you scroll
            this.el.setAttribute('rotation', `0 ${45 + (scrollPercent * 20)} 0`);
          });
        }
      });
    </script>
  </body>
</html>
